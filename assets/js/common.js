// ---------------------------------------
//  イベント初期化
// ---------------------------------------
document.addEventListener("DOMContentLoaded",e=>{setupGnav(),smoothScroll(),seqFadeAnime()}),window.addEventListener("load",e=>{smoothScroll_page(),bgFlow()}),window.addEventListener("scroll",e=>{bgFlow(),scrollToggleClass(".js_headerCange",".js_header","is_change")});const canvas=document.getElementById("js_trail"),isTouchDevice="ontouchstart"in window||0<navigator.maxTouchPoints||window.matchMedia("(pointer: coarse)").matches;if(isTouchDevice)canvas&&(canvas.style.display="none");else{const d=canvas.getContext("2d");canvas.width=innerWidth,canvas.height=innerHeight;let a=innerWidth/2,r=innerHeight/2,c=a,l=r;const i=[],j=15;function draw(){requestAnimationFrame(draw),d.fillStyle="rgba(0,0,0,0.48)",d.fillRect(0,0,canvas.width,canvas.height),i.unshift({x:c,y:l}),i.length>j&&i.pop();var e=a-c,t=r-l,e=Math.hypot(e,t),o=Math.min(j,6+.36*e),t=Math.min(1,.94+.008*e);d.beginPath(),d.lineWidth=1.2,d.lineCap="round",d.strokeStyle=`rgba(255,255,255,${t})`;for(let e=0;e<o&&e<i.length;e++){var s=i[e];0===e?d.moveTo(s.x,s.y):d.lineTo(s.x,s.y)}d.stroke(),d.save(),d.filter="blur(4px)",d.beginPath(),d.lineWidth=1.2,d.lineCap="round",d.strokeStyle=`rgba(255,255,255,${.5*t})`;for(let e=0;e<o&&e<i.length;e++){var n=i[e];0===e?d.moveTo(n.x,n.y):d.lineTo(n.x,n.y)}d.stroke(),d.restore()}addEventListener("mousemove",e=>{a=e.clientX,r=e.clientY}),gsap.ticker.fps(60),gsap.ticker.add(()=>{c+=.11*(a-c),l+=.11*(r-l)}),draw()}let scrollY=0;function lockBody(){scrollY=window.scrollY||window.pageYOffset,document.body.style.position="fixed",document.body.style.top=`-${scrollY}px`,document.body.style.left="0",document.body.style.right="0",document.body.classList.add("is_fixed")}function unlockBody(){var e=-parseInt(document.body.style.top||"0",10);document.body.style.position="",document.body.style.top="",document.body.style.left="",document.body.style.right="",document.body.classList.remove("is_fixed"),window.scrollTo(0,e)}function setupGnav(){var e=window.matchMedia("(max-width: 1024px)");e.addEventListener("change",handleGnav),handleGnav(e),window.addEventListener("keydown",e=>{"Escape"===e.key&&closeGnav()});const t=document.getElementById("js_gnavBtn");document.getElementById("js_focusTrap")?.addEventListener("focus",()=>t.focus())}function handleGnav(e){const t=document.querySelector("#js_gnavBtn"),o=document.querySelector(".js_gnav"),s=document.querySelector(".js_header");var n=document.querySelectorAll(".bl_gnav_item > a");o&&t&&(e.matches?(t.dataset.bound||(t.addEventListener("click",()=>toggleGnav(o,s,t)),t.dataset.bound="true"),n.forEach(e=>{e.dataset.bound||(e.addEventListener("click",()=>closeGnav()),e.dataset.bound="true")})):resetGnav(o,s,t))}function toggleGnav(e,t,o){e.classList.toggle("is_active"),t?.classList.toggle("is_active");t=e.classList.contains("is_active");const s=document.querySelector(".js_gnavList");t?(lockBody(),setTimeout(()=>{s?.classList.add("is_active")},200)):(s?.classList.remove("is_active"),unlockBody()),o.setAttribute("aria-expanded",String(t)),e.setAttribute("aria-hidden",String(!t))}function closeGnav(){var e=document.querySelector(".js_gnav"),t=document.querySelector(".js_header"),o=document.querySelector("#js_gnavBtn"),s=document.querySelector(".js_gnavList");e&&o&&(e.classList.remove("is_active"),t?.classList.remove("is_active"),s?.classList.remove("is_active"),unlockBody(),e.setAttribute("aria-hidden","true"),o.setAttribute("aria-expanded","false"))}function resetGnav(e,t,o){var s=document.querySelector(".js_gnavList");e.classList.remove("is_active"),t?.classList.remove("is_active"),s?.classList.remove("is_active"),unlockBody(),e.setAttribute("aria-hidden","false"),o.setAttribute("aria-expanded","false")}function scrollToggleClass(e,t,o){$(e).length&&(scroll=$(window).scrollTop(),startPos=$(e).offset().top-100,endPos=startPos+$(e).outerHeight(),scroll>startPos?$(t).addClass(o):$(t).removeClass(o))}function fadeAnime(){$(".js_fadeInTrig").each(function(){var e=$(this).offset().top-50,t=$(window).scrollTop();e-$(window).height()<=t&&$(this).addClass("is_fadeInAnim")}),$(".js_slideUpTrig").each(function(){var e=$(this).offset().top-50,t=$(window).scrollTop();e-$(window).height()<=t&&$(this).addClass("is_slideUpAnim")})}function seqFadeAnime(){var e=document.querySelectorAll(".js_seqFade");if(e.length){const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(setTimeout(()=>{e.target.classList.add("is_animated")},300),t.unobserve(e.target))})},{root:null,rootMargin:"0px 0px -10% 0px",threshold:0});e.forEach(e=>t.observe(e))}}function bgFlow(){var e=document.querySelectorAll(".js_bgFlow");const t=new IntersectionObserver((e,t)=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("is_animated"),t.unobserve(e.target))})},{threshold:.2});e.forEach(e=>t.observe(e))}function smoothScroll(){const t=$(".js_header").outerHeight();$('a[href*="#"]').click(function(){var e=$("#"===this.hash?"html":this.hash);if(e.length)return e=e.offset().top-t,$("html, body").animate({scrollTop:e},400,"swing"),!1})}function smoothScroll_page(){var e=$(".js_header").outerHeight(),t=location.hash;if(t)return t=$(t).offset().top-e,$("html, body").animate({scrollTop:t},50,"swing"),!1}function scroll_control(e){e.preventDefault()}function no_scroll(){document.addEventListener("mousewheel",scroll_control,{passive:!1}),document.addEventListener("touchmove",scroll_control,{passive:!1})}function return_scroll(){document.removeEventListener("mousewheel",scroll_control,{passive:!1}),document.removeEventListener("touchmove",scroll_control,{passive:!1})}setupGnav();